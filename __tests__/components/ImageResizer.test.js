import { render, screen, waitFor, fireEvent } from '@testing-library/react';\nimport userEvent from '@testing-library/user-event';\nimport ImageResizerClient from '../../app/image-resizer/ImageResizer.client';\nimport { createMockImageFile, simulateFileDrop, expectElementToHaveText } from '../../__tests__/test-utils';\n\ndescribe('ImageResizer Tool', () => {\n  const user = userEvent.setup();\n\n  beforeEach(() => {\n    render(<ImageResizerClient />);\n  });\n\n  test('renders title and description', () => {\n    expect(screen.getByText('Image Resizer')).toBeInTheDocument();\n    expect(screen.getByText(/resize images to exact dimensions/i)).toBeInTheDocument();\n  });\n\n  test('renders file drop zone, input, and dimension inputs', () => {\n    expect(screen.getByText(/drag and drop here/i)).toBeInTheDocument();\n    expect(screen.getByLabelText(/or click to select file/i)).toBeInTheDocument();\n    expect(screen.getByLabelText(/width \(px\)/i)).toBeInTheDocument();\n    expect(screen.getByLabelText(/height \(px\)/i)).toBeInTheDocument();\n    expect(screen.getByLabelText(/maintain aspect ratio/i)).toBeInTheDocument();\n  });\n\n  test('validates image file on drop', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = new File([''], 'document.txt', { type: 'text/plain' });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/invalid file type/i)).toBeInTheDocument();\n    });\n  });\n\n  test('displays uploaded image and original dimensions', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 }); // 10KB\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/test.jpg/i)).toBeInTheDocument();\n      expect(screen.getByText(/original dimensions:/i)).toBeInTheDocument();\n      expect(screen.getByText(/800 x 600/i)).toBeInTheDocument(); // Default dimensions from mock\n    });\n  });\n\n  test('resizes image and updates display when dimensions are set', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/original dimensions:/i)).toBeInTheDocument();\n    });\n\n    const widthInput = screen.getByLabelText(/width \(px\)/i);\n    const heightInput = screen.getByLabelText(/height \(px\)/i);\n\n    await user.clear(widthInput);\n    await user.type(widthInput, '500');\n    await user.clear(heightInput);\n    await user.type(heightInput, '400');\n\n    await waitFor(() => {\n      expect(screen.getByText(/resized dimensions:/i)).toBeInTheDocument();\n      expect(screen.getByText(/500 x 400 px/i)).toBeInTheDocument();\n    });\n  });\n\n  test('maintains aspect ratio when only width is set', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/original dimensions:/i)).toBeInTheDocument();\n    });\n\n    const widthInput = screen.getByLabelText(/width \(px\)/i);\n    await user.clear(widthInput);\n    await user.type(widthInput, '500');\n\n    // Height input should update automatically if aspect ratio is maintained\n    await waitFor(() => {\n      const heightInput = screen.getByLabelText(/height \(px\)/i);\n      expect(heightInput.value).toBe('400'); // 800 * (500/1000)\n    });\n  });\n\n  test('maintains aspect ratio when only height is set', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/original dimensions:/i)).toBeInTheDocument();\n    });\n\n    const heightInput = screen.getByLabelText(/height \(px\)/i);\n    await user.clear(heightInput);\n    await user.type(heightInput, '400');\n\n    // Width input should update automatically if aspect ratio is maintained\n    await waitFor(() => {\n      const widthInput = screen.getByLabelText(/width \(px\)/i);\n      expect(widthInput.value).toBe('500'); // 1000 * (400/800)\n    });\n  });\n\n  test('disables aspect ratio lock when one dimension is set to 0', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    const widthInput = screen.getByLabelText(/width \(px\)/i);\n    const aspectRatioCheckbox = screen.getByLabelText(/maintain aspect ratio/i);\n\n    await user.clear(widthInput);\n    await user.type(widthInput, '0');\n\n    expect(aspectRatioCheckbox).toBeDisabled();\n  });\n\n  test('allows distortion when aspect ratio is not maintained', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/original dimensions:/i)).toBeInTheDocument();\n    });\n\n    // Uncheck maintain aspect ratio\n    const aspectRatioCheckbox = screen.getByLabelText(/maintain aspect ratio/i);\n    await user.click(aspectRatioCheckbox);\n\n    const widthInput = screen.getByLabelText(/width \(px\)/i);\n    const heightInput = screen.getByLabelText(/height \(px\)/i);\n\n    await user.clear(widthInput);\n    await user.type(widthInput, '200');\n    await user.clear(heightInput);\n    await user.type(heightInput, '600');\n\n    await waitFor(() => {\n      expect(screen.getByText(/resized dimensions:/i)).toBeInTheDocument();\n      expect(screen.getByText(/200 x 600 px/i)).toBeInTheDocument();\n    });\n  });\n\n  test('download button works after resizing', async () => {\n    const mockClipboard = {\n      writeText: jest.fn().mockResolvedValue(undefined),\n    };\n    Object.assign(navigator, { clipboard: mockClipboard });\n\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    const widthInput = screen.getByLabelText(/width \(px\)/i);\n    await user.type(widthInput, '500');\n\n    await waitFor(() => {\n      expect(screen.getByText(/download resized/i)).toBeInTheDocument();\n    });\n\n    const downloadBtn = screen.getByText(/download resized/i);\n    await user.click(downloadBtn);\n\n    await waitFor(() => {\n      expect(global.URL.createObjectURL).toHaveBeenCalled();\n    });\n  });\n\n  test('clear button resets the state', async () => {\n    const dropZone = screen.getByText(/drag and drop here/i);\n    const mockFile = createMockImageFile('test.jpg', 'image/jpeg');\n    Object.defineProperty(mockFile, 'size', { value: 10240 });\n    await simulateFileDrop(dropZone, [mockFile]);\n\n    await waitFor(() => {\n      expect(screen.getByText(/test.jpg/i)).toBeInTheDocument();\n    });\n\n    const clearBtn = screen.getByText(/clear/i);\n    await user.click(clearBtn);\n\n    await waitFor(() => {\n      expect(screen.getByText(/drag and drop here/i)).toBeInTheDocument();\n      expect(screen.queryByText(/test.jpg/i)).not.toBeInTheDocument();\n      expect(screen.getByLabelText(/width \(px\)/i)).toHaveValue('800');\n      expect(screen.getByLabelText(/height \(px\)/i)).toHaveValue('600');\n    });\n  });\n});\n